{% extends "layout.html.twig" %}

{% form_theme form with ['bootstrap_3_horizontal_layout.html.twig', _self] %}

{% block form_label_class -%}
col-sm-3
{%- endblock form_label_class %}

{% block form_group_class -%}
col-sm-9
{%- endblock form_group_class %}

{% block body %}

<div class="row">
	<div class="col-sm-2">
		<h4{% if flow.getCurrentStepNumber() != 1 %} class="text-muted"{% endif %}>Votre identité <span class="label {% if flow.getCurrentStepNumber() == 1 %}label-primary{% else %}label-default{% endif %}">1</span></h4>
	</div>
	<div class="col-sm-2">
		<h4{% if flow.getCurrentStepNumber() != 2 %} class="text-muted"{% endif %}>Vos contacts <span class="label {% if flow.getCurrentStepNumber() == 2 %}label-primary{% else %}label-default{% endif %}">2</span></h4>
	</div>
	<div class="col-sm-2">
		<h4{% if flow.getCurrentStepNumber() != 3 %} class="text-muted"{% endif %}>Attestations <span class="label {% if flow.getCurrentStepNumber() == 3 %}label-primary{% else %}label-default{% endif %}">3</span></h4>
	</div>
	<div class="col-sm-2">
		<h4{% if flow.getCurrentStepNumber() != 4 %} class="text-muted"{% endif %}>Sondage <span class="label {% if flow.getCurrentStepNumber() == 4 %}label-primary{% else %}label-default{% endif %}">4</span></h4>
	</div>
	<div class="col-sm-2">
		<h4 class="text-muted">Fin <span class="label label-default">5</span></h4>
	</div>
</div><br />

{% if flow.getCurrentStepNumber() == 1 %}
<div class="well">
	<p>
		Une fois votre inscription validée, ces données seront transmises à la Fédération Française d'Aviron pour la création de votre licence-assurance.<br />
		L'assurance est souscrite auprès de la MAIF. Il est important de remplir les champs obligatoires avec précision.
	</p>
</div>
{% endif %}


{{ form_start(form) }}
{{ form_errors(form) }}

{% if flow.getCurrentStepNumber() == 1 %}
{{ form_row(form.civilite) }}
{{ form_row(form.nom) }}
{{ form_row(form.prenom) }}
{{ form_row(form.datenaissance) }}
{{ form_row(form.nationalite) }}
<div class="form-group">
	{{ form_label(form.numeroVoie) }}
	<div class="col-sm-1">
		{{ form_widget(form.numeroVoie) }}
	</div>
	<div class="col-sm-3">
		{{ form_widget(form.typeVoie) }}
	</div>
	<div class="col-sm-5">
		{{ form_widget(form.libelleVoie) }}
	</div>
</div>
{% endif %}

{% if flow.getCurrentStepNumber() == 2 %}
<div class="well">
	<p>
	Nous communiquons essentiellement par mail, une à deux fois par mois, pour vous proposer des activités et vous tenir informé de la vie du Club.<br/>
	Nous donnons également cette adresse à la Fédération Française d'Aviron afin qu'elle vous fasse parvenir votre licence de façon dématérialisée.<br/>
	En aucun cas nous ne donnons votre adresse mail à l'un de nos partenaires.
	</p>
	<p>
	Dans quelques rares cas, nous communiquons également par téléphone.<br/>
	Vos numéros ne sont ni communiqués à la Fédération Française d'Aviron ni à nos partenaires.<br/>
	Sentez-vous libre d'ajouter autant de numéros que nécessaire.
	</p>
</div>
	{{ form_row(form.email) }}

	<ul class="contacts list-group" data-prototype="{{ form_widget(form.contacts.vars.prototype)|e('html_attr') }}">
		{% for contact in form.contacts %}
			<li class="list-group-item">
				{{ form_row(contact.typeContact) }}
				{{ form_row(contact.nomContact) }}
				{{ form_row(contact.telephoneEmail) }}
			</li>
		{% endfor %}
	</ul>
{% endif %}

{% if flow.getCurrentStepNumber() == 3 %}
<div class="well">
	<p>
		L'Aviron Club de Bourges est une association de forme loi 1901. Nous avons un <a href="#">règlement intérieur que vous devez consulter</a>.
	</p>
</div>
{% for licence in form.licences %}
	<div class="form-group">
		<label for="accepteReglementInterieur" class="col-sm-3 control-label required">Règlement intérieur*</label>
		<div class="col-sm-9">
			{{ form_widget(licence.accepteReglementInterieur) }}
		</div>
	</div>
<div class="well">
	<p>
		Même si nous sommes essentiellement sur l'eau et non dans l'eau, il est possible de chavirer. Il est donc impératif de savoir nager !
	</p>
</div>
	<div class="form-group">
		<label for="declareSavoirNager" class="col-sm-3 control-label required">Savoir Nager*</label>
		<div class="col-sm-9">
			{{ form_widget(licence.declareSavoirNager) }}
		</div>
	</div>
<div class="well">
	<p>
		Pour promouvoir notre activité, nous prenons des photos que nous publions sur notre site Internet et sur les réseaux sociaux (Facebook, Instagram).<br/>
		Nous faisons très attention à votre image car celle-ci a une incidence sur notre propre image. 
	</p>
</div>
	{{ form_row(licence.autoriseDroitImage) }}
{% endfor %}
{% endif %}


{% if flow.getCurrentStepNumber() == 4 %}
<div class="well">
	<p>
		Notre objectif est que chacun trouve sa place dans notre association. <br/>
		Ce petit sondage nous permet de mieux connaitre nos adhérents et de vous proposer des activités en concéquence. 
	</p>
	<p>
		L'Aviron Club de Bourges fonctionne grâce au dévouement de gentils bénévoles. Nous serions ravis de vous compter parmis eux !<br/>
		Pour cela nous aimerions en savoir un peu plus sur vous. 
	</p>
</div>
{{ form_row(form.enviesPratiques) }}
{{ form_row(form.frequencePratique) }}
<div class="form-group">
		<label for="aPermisBateauEauxInterieures" class="col-sm-3 control-label required">Permis</label>
		<div class="col-sm-9">
			{{ form_widget(form.engagementAssociation.aPermisBateauEauxInterieures) }}
		</div>
	</div>
{{ form_row(form.engagementAssociation.aPermisBateauEauxInterieures) }}
{{ form_row(form.engagementAssociation.aPermisBateauCotier) }}
{{ form_row(form.engagementAssociation.aPermisRemorqueEB) }}
{{ form_row(form.engagementAssociation.aPermisRemorqueB96) }}
{{ form_row(form.engagementAssociation.brevetSecourisme) }}
{{ form_row(form.engagementAssociation.encadrementSportif) }}
{{ form_row(form.engagementAssociation.communication) }}
{{ form_row(form.engagementAssociation.informatique) }}
{{ form_row(form.engagementAssociation.technique) }}
{{ form_row(form.engagementAssociation.autres) }}
{% endif %}

{{ form_rest(form) }}

<p>
* Champ obligatoire<br />
{% if flow.getCurrentStepNumber() == 1 %}

(1) Nationalité : si vous avez plusieurs nationalités, dont la nationalité française, merci de sélectionner la France.<br/>
En effet, la nationalité a une incidence sur la possibilité de participer aux épreuves nationales.<br/>
(2) Adresse / Lieu dit : une seule des deux lignes obligatoires. 
{% endif %}
</p>

{% include '@CraueFormFlow/FormFlow/buttons.html.twig' with {
		craue_formflow_button_class_last: 'btn btn-primary',
		craue_formflow_button_class_back: 'btn',
		craue_formflow_button_render_reset: false,
		craue_formflow_button_label_next: 'Etape suivante',
		craue_formflow_button_label_back: 'Revenir à l\'étape précédente',
		craue_formflow_button_label_finish: 'Je me préinscris !',
	} %}
	{{ form_end(form) }}

	<script type="text/javascript">
var $collectionHolder;

// setup an "add a tag" link
var $addTagButton = $('<button type="button" class="add_tag_link btn">Ajouter un contact</button>');
var $newLinkLi = $('<li class="list-group-item"></li>').append($addTagButton);

jQuery(document).ready(function() {
    // Get the ul that holds the collection of tags
    $collectionHolder = $('ul.contacts');

	// add a delete link to all of the existing tag form li elements
	$nombreContacts = 0;
    $collectionHolder.find('li').each(function() {
		if ($nombreContacts > 1) {
        	addTagFormDeleteLink($(this));
		}
		$nombreContacts++;
    });

    // add the "add a tag" anchor and li to the tags ul
    $collectionHolder.append($newLinkLi);

    // count the current form inputs we have (e.g. 2), use that as the new
    // index when inserting a new item (e.g. 2)
    $collectionHolder.data('index', $collectionHolder.find('input').length);

    $addTagButton.on('click', function(e) {
        // add a new tag form (see next code block)
        addTagForm($collectionHolder, $newLinkLi);
    });
});

		function addTagForm($collectionHolder, $newLinkLi) { // Get the data-prototype explained earlier
var prototype = $collectionHolder.data('prototype');

// get the new index
var index = $collectionHolder.data('index');

var newForm = prototype;
// You need this only if you didn't set 'label' => false in your tags field in TaskType
// Replace '__name__label__' in the prototype's HTML to
// instead be a number based on how many items we have
// newForm = newForm.replace(/__name__label__/g, index);

// Replace '__name__' in the prototype's HTML to
// instead be a number based on how many items we have
newForm = newForm.replace(/__name__/g, index);

// increase the index with one for the next item
$collectionHolder.data('index', index + 1);

// Display the form in the page in an li, before the "Add a tag" link li
var $newFormLi = $('<li class="list-group-item"></li>').append(newForm);
$newLinkLi.before($newFormLi);

// add a delete link to the new form
    addTagFormDeleteLink($newFormLi);

}

function addTagFormDeleteLink($tagFormLi) {
    var $removeFormButton = $('<button type="button" class="btn">Supprimer ce contact</button>');
    $tagFormLi.append($removeFormButton);

    $removeFormButton.on('click', function(e) {
        // remove the li for the tag form
        $tagFormLi.remove();
    });
}
	</script>

{% endblock %}
